<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Samba Voyage | Suivi de mon Sinistre</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f1f5f9; display: flex; justify-content: center; padding: 50px; }
        .tracking-card { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        .step { display: flex; align-items: center; margin-bottom: 25px; opacity: 0.3; transition: 0.5s; }
        .step.active { opacity: 1; }
        .circle { width: 30px; height: 30px; border-radius: 50%; background: #cbd5e1; margin-right: 15px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .active .circle { background: #22c55e; }
        .status-text { font-weight: 500; color: #1e293b; }
    </style>
</head>
<body>
    <div class="tracking-card">
        <h2 style="color: #0070bb; text-align: center;">Suivi de votre dossier</h2>
        <div style="margin-bottom: 30px; display: flex; gap: 10px;">
            <input type="text" id="idSinistre" placeholder="N° de sinistre (ex: 1)" style="flex:1; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
            <button onclick="suivreSinistre()" style="padding: 10px 20px; background: #0070bb; color: white; border: none; border-radius: 8px; cursor: pointer;">Chercher</button>
        </div>

        <div id="steps-container" style="display:none;">
            <div class="step" id="step1"><div class="circle">1</div><div class="status-text">Sinistre déclaré</div></div>
            <div class="step" id="step2"><div class="circle">2</div><div class="status-text">Validé par Samba Assurance</div></div>
            <div class="step" id="step3"><div class="circle">3</div><div class="status-text">Dédommagement effectué par l'AFA</div></div>
        </div>
    </div>

    <script>
        async function suivreSinistre() {
            const id = document.getElementById('idSinistre').value;
            const res = await fetch(`http://localhost:3000/api/liste-sinistres`);
            const sinistres = await res.json();
            const s = sinistres.find(x => x.id == id);

            if(!s) return alert("Sinistre non trouvé");

            document.getElementById('steps-container').style.display = 'block';
            
            // Logique d'allumage des étapes
            document.getElementById('step1').classList.add('active');
            if(s.confirmation_samba) document.getElementById('step2').classList.add('active');
            if(s.statut_afa === 'DÉDOMMAGÉ') document.getElementById('step3').classList.add('active');
        }
    </script>
</body>
</html>